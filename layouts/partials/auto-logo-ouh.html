{{- $attributes := dict "class" "nolightbox" }}
{{- $title := "" }}
{{- if isset site.Params "linktitle" }}
  {{- $title = site.Params.linkTitle | default " " }}
{{- end }}
{{- if not (len $title) }}
  {{- $title = site.Title }}
{{- end }}
{{- $title = trim $title "\n\r\t " }}

{{- $manualWrap := strings.Contains $title "\n" }}

{{- $direction := site.Params.logo.direction | default "row" }}

{{- /* Build map of variant logos */}}
{{- $logoMap := dict }}
{{- $themevariants := partialCached "_relearn/themeVariants.gotmpl" site.Home }}
{{- range $themevariants }}
  {{- if and (isset . "logoOUH") (not (isset . "auto")) }}
    {{- $logoMap = merge $logoMap (dict .identifier (dict "src" .logoOUH.src "variant" .identifier "alt" .logoOUH.alt)) }}
  {{- end }}
{{- end }}

{{- /* Group logos by source, preserving alt text */}}
{{- $logoGroups := dict }}
{{- range $variantId, $logoInfo := $logoMap }}
  {{- $src := $logoInfo.src }}
  {{- if $src }}
    {{- $existingData := dict "variants" slice "alt" "" }}
    {{- if isset $logoGroups $src }}
      {{- $existingData = index $logoGroups $src }}
    {{- end }}
    {{- $updatedVariants := $existingData.variants | append $variantId }}
    {{- /* Use the first non-empty alt text found */}}
    {{- $altText := $existingData.alt }}
    {{- if and (not $altText) $logoInfo.alt }}
      {{- $altText = $logoInfo.alt }}
    {{- end }}
    {{- $logoGroups = merge $logoGroups (dict $src (dict "variants" $updatedVariants "alt" $altText)) }}
  {{- end }}
{{- end }}

{{- /* Render logo container with all variants */}}
{{- if or $logoGroups $title }}
        <a id="R-logo" class="R-default direction-{{ $direction }}{{ if $manualWrap }} manual-wrap{{ end }}" href="{{ partial "permalink.gotmpl" (dict "to" site.Home) }}">
  {{- range $logoSrc, $logoData := $logoGroups }}
    {{- $variantList := delimit $logoData.variants " " }}
    {{- $altText := $logoData.alt | default "Logo image" }}
          <span class="logo-image default-animation" data-r-logo-variant="{{ $variantList }}">
{{ partial "shortcodes/image.html" (dict "page" site.Home "url" $logoSrc "alt" $altText "attributes" $attributes) }}
          </span>
  {{- end }}
        </a>
{{- end }}

{{- /* Build map of variant logos (standard logo) */}}
{{- $logoMap := dict }}
{{- $themevariants := partialCached "_relearn/themeVariants.gotmpl" site.Home }}
{{- range $themevariants }}
  {{- if and (isset . "logo") (not (isset . "auto")) }}
    {{- $logoMap = merge $logoMap (dict .identifier (dict "src" .logo.src "variant" .identifier "alt" .logo.alt)) }}
  {{- end }}
{{- end }}

{{- /* Group logos by source, preserving alt text */}}
{{- $logoGroups := dict }}
{{- range $variantId, $logoInfo := $logoMap }}
  {{- $src := $logoInfo.src }}
  {{- if $src }}
    {{- $existingData := dict "variants" slice "alt" "" }}
    {{- if isset $logoGroups $src }}
      {{- $existingData = index $logoGroups $src }}
    {{- end }}
    {{- $updatedVariants := $existingData.variants | append $variantId }}
    {{- /* Use the first non-empty alt text found */}}
    {{- $altText := $existingData.alt }}
    {{- if and (not $altText) $logoInfo.alt }}
      {{- $altText = $logoInfo.alt }}
    {{- end }}
    {{- $logoGroups = merge $logoGroups (dict $src (dict "variants" $updatedVariants "alt" $altText)) }}
  {{- end }}
{{- end }}

{{- /* Render logo container with all variants */}}
{{- if or $logoGroups $title }}
        <a id="R-logo" class="R-default direction-{{ $direction }}{{ if $manualWrap }} manual-wrap{{ end }}" href="{{ partial "permalink.gotmpl" (dict "to" site.Home) }}">
  {{- range $logoSrc, $logoData := $logoGroups }}
    {{- $variantList := delimit $logoData.variants " " }}
    {{- $altText := $logoData.alt | default "Logo image" }}
          <span class="logo-image default-animation" data-r-logo-variant="{{ $variantList }}">
{{ partial "shortcodes/image.html" (dict "page" site.Home "url" $logoSrc "alt" $altText "attributes" $attributes) }}
          </span>
  {{- end }}
  {{- with $title }}
          <!-- <span class="logo-title default-animation">{{ . }}</span> -->
  {{- end }}
        </a>
{{- end }}

<style>
:root {
    --LOGO-IMAGE-width: 16rem;
}
.logo-image {
    margin-top: 0.25rem;
    margin-bottom: 0.25rem;
}
</style>
